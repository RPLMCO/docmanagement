
Function GenericExportandMailMerge(sQueryName As String, sTemplateName As String)
'============================================================================
' Name        : GenericExportandMailMerge
' Author      : Erica L Ingram
' Copyright   : 2019, A Quo Co.
' Call command: Call GenericExportandMailMerge(sQueryName, sTemplateName)
' Description : exports to specified template from T:\Document Generator\Templates and saves in T:\In Progress\sCourtDatesID\
'============================================================================

Dim sTemplatePath As String, sLinkToExportedXLS As String, sCourtDatesID As String
Dim oWordDoc As Object
Dim qdfQuery As QueryDef
Dim rstQuery As DAO.Recordset

sCourtDatesID = Forms![NewMainMenu]![ProcessJobSubformNMM].Form![JobNumberField]
sTemplatePath = "T:\In Progress\" & sCourtDatesID & "\" & sCourtDatesID & "-" & sTemplateName & ".docx"
sLinkToExportedXLS = "T:\In Progress\" & sCourtDatesID & "\WorkingFiles\" & sCourtDatesID & "-Temp-Export-" & sTemplateName & ".xls"

Set qdfQuery = CurrentDb.QueryDefs(sQueryName)
qdfQuery.Parameters(0) = sCourtDatesID
Set rstQuery = qdf.OpenRecordset

DoCmd.OutputTo acOutputQuery, sQueryName, acFormatXLS, sLinkToExportedXLS, False

Set oWordDoc = GetObject("T:\Document Generator\Templates\" & sTemplateName & "-Template.docx", "Word.Document")
oWordDoc.Application.Visible = False
oWordDoc.MailMerge.OpenDataSource Name:=sLinkToExportedXLS, ReadOnly:=True
oWordDoc.MailMerge.Execute

oWordDoc.MailMerge.MainDocumentType = wdNotAMergeDocument
oWordDoc.Application.ActiveDocument.ExportAsFixedFormat _
outputFileName:="T:\In Progress\" & sCourtDatesID & "\WorkingFiles\" & sCourtDatesID & "-" & sTemplateName & ".pdf", _
ExportFormat:=wdExportFormatPDF
oWordDoc.Application.ActiveDocument.SaveAs filename:=sTemplatePath
oWordDoc.Application.ActiveDocument.Close

Set oWordDoc = Nothing
rstQuery.Close
Set rstQuery = Nothing
qdfQuery.Close
Set qdfQuery = Nothing

End Function
